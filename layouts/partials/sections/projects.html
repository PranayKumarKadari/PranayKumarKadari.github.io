{{ if .Site.Params.projects.enable }}

<section id="projects" class="py-5">
  <div class="container px-3 px-sm-5 px-md-5 px-lg-5 pt-lg-3">

    <h3 class="text-center mb-5">
      {{ .Site.Params.projects.title }}
    </h3>

    <!-- Tabs -->
    <div class="d-flex justify-content-center mb-4 gap-3">
      <button class="btn btn-outline-light active"
              id="tab-current"
              onclick="switchTab('current')">
        Current Projects
      </button>

      <button class="btn btn-outline-light"
              id="tab-past"
              onclick="switchTab('past')">
        Past Projects
      </button>
    </div>

    <!-- ================= CURRENT PROJECTS ================= -->
    <div id="current-projects" class="row g-4 justify-content-center">
      {{ $current := where .Site.Params.projects.items "type" "current" }}

      {{ range first 3 $current }}
        {{ $id := urlize .title }}

        <div class="col-12 col-md-6 col-lg-4">
          <div class="card h-100">

            {{ if .image }}
            <img src="{{ .image }}"
                 class="card-img-top"
                 alt="{{ .title }}">
            {{ end }}

            <div class="card-body d-flex flex-column">
              <h5 class="card-title">{{ .title }}</h5>
              <p class="card-text">{{ .content }}</p>

              {{ if .description }}
              <button class="btn btn-outline-light btn-sm mt-auto"
                      onclick="openModal('{{ $id }}')">
                More Info
              </button>
              {{ end }}
            </div>
          </div>
        </div>

        <!-- ===== MODAL ===== -->
        {{ if .description }}
        <div id="modal-{{ $id }}" class="custom-modal">
          <div class="custom-modal-content">
            <span class="close-btn"
                  onclick="closeModal('{{ $id }}')">&times;</span>

            <h4 class="mb-3">{{ .title }}</h4>

            <ul>
              {{ range .description }}
                <li>{{ . }}</li>
              {{ end }}
            </ul>
          </div>
        </div>
        {{ end }}

      {{ end }}
    </div>

    <!-- View More -->
    {{ if gt (len $current) 3 }}
    <div class="text-center mt-4">
      <button class="btn btn-outline-light"
              onclick="showAllCurrent()">
        View More
      </button>
    </div>
    {{ end }}

    <!-- ================= PAST PROJECTS ================= -->
    <div id="past-projects"
         class="row g-4 justify-content-center d-none mt-4">

      {{ range where .Site.Params.projects.items "type" "past" }}
      <div class="col-12 col-md-6 col-lg-4">
        <div class="card h-100">

          {{ if .image }}
          <img src="{{ .image }}"
               class="card-img-top"
               alt="{{ .title }}">
          {{ end }}

          <div class="card-body">
            <h5 class="card-title">{{ .title }}</h5>
            <p class="card-text">{{ .content }}</p>
          </div>
        </div>
      </div>
      {{ end }}

    </div>

  </div>
</section>

<!-- ================= STYLES ================= -->
<style>
.custom-modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.75);
  z-index: 9999;
}

.custom-modal-content {
  background: #1f2428;
  color: #fff;
  max-width: 850px;
  max-height: 80vh;
  overflow-y: auto;
  margin: 8vh auto;
  padding: 30px;
  border-radius: 14px;
  position: relative;
}

.close-btn {
  position: absolute;
  top: 12px;
  right: 18px;
  font-size: 28px;
  cursor: pointer;
}
</style>

<!-- ================= SCRIPTS ================= -->
<script>
function openModal(id) {
  document.getElementById('modal-' + id).style.display = 'block';
}

function closeModal(id) {
  document.getElementById('modal-' + id).style.display = 'none';
}

function switchTab(tab) {
  document.getElementById('current-projects')
    .classList.toggle('d-none', tab !== 'current');
  document.getElementById('past-projects')
    .classList.toggle('d-none', tab !== 'past');

  document.getElementById('tab-current')
    .classList.toggle('active', tab === 'current');
  document.getElementById('tab-past')
    .classList.toggle('active', tab === 'past');
}

function showAllCurrent() {
  document.querySelectorAll('#current-projects .col-12')
    .forEach(el => el.style.display = 'block');
}
</script>

{{ end }}
